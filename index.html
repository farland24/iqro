<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerakan Membaca Al-Quran - SMKN 5 Samarinda</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&amp;family=Plus+Jakarta+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    .font-arabic { font-family: 'Amiri', serif; }
    .font-main { font-family: 'Plus Jakarta Sans', sans-serif; }
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }
    .rank-gold { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
    .rank-silver { background: linear-gradient(135deg, #9ca3af, #6b7280); }
    .rank-bronze { background: linear-gradient(135deg, #d97706, #b45309); }
    .pattern-islamic {
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0L35 15H45L37 24L40 40L30 32L20 40L23 24L15 15H25L30 0Z' fill='%23059669' fill-opacity='0.05'/%3E%3C/svg%3E");
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
    .stagger-1 { animation-delay: 0.1s; }
    .stagger-2 { animation-delay: 0.2s; }
    .stagger-3 { animation-delay: 0.3s; }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full font-main">
  <div id="app-container" class="h-full w-full overflow-auto pattern-islamic" style="background-color: #f0fdf4;"><!-- Header -->
   <header class="relative overflow-hidden" style="background-color: #047857;">
    <div class="absolute inset-0 opacity-10">
     <svg class="w-full h-full" viewbox="0 0 100 100" preserveaspectratio="none"><pattern id="islamic-pattern" x="0" y="0" width="20" height="20" patternunits="userSpaceOnUse">
       <path d="M10 0L12 8H20L14 13L16 20L10 16L4 20L6 13L0 8H8L10 0Z" fill="white" />
      </pattern> <rect width="100%" height="100%" fill="url(#islamic-pattern)" />
     </svg>
    </div>
    <div class="relative max-w-6xl mx-auto px-4 py-8 text-center">
     <div class="mb-4"><span class="font-arabic text-4xl md:text-5xl text-white opacity-90">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê</span>
     </div>
     <h1 id="app-title" class="text-2xl md:text-4xl font-bold text-white mb-2">Gerakan Membaca Al-Quran</h1>
     <p id="school-name" class="text-lg md:text-xl text-emerald-100 font-medium">SMKN 5 Samarinda</p>
     <p id="subtitle" class="text-sm md:text-base text-emerald-200 mt-1">Program Literasi Al-Quran</p>
    </div>
   </header><!-- Stats Overview -->
   <div class="max-w-6xl mx-auto px-4 -mt-6 relative z-10">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
     <div class="glass-card rounded-xl p-4 shadow-lg border border-emerald-100 animate-fade-in stagger-1" style="opacity: 0;">
      <div class="text-2xl md:text-3xl font-bold" style="color: #047857;" id="stat-total-siswa">
       0
      </div>
      <div class="text-xs md:text-sm text-gray-600">
       Total Peserta
      </div>
     </div>
     <div class="glass-card rounded-xl p-4 shadow-lg border border-emerald-100 animate-fade-in stagger-2" style="opacity: 0;">
      <div class="text-2xl md:text-3xl font-bold" style="color: #047857;" id="stat-total-juz">
       0
      </div>
      <div class="text-xs md:text-sm text-gray-600">
       Total Juz Dibaca
      </div>
     </div>
     <div class="glass-card rounded-xl p-4 shadow-lg border border-emerald-100 animate-fade-in stagger-3" style="opacity: 0;">
      <div class="text-2xl md:text-3xl font-bold" style="color: #047857;" id="stat-total-halaman">
       0
      </div>
      <div class="text-xs md:text-sm text-gray-600">
       Total Halaman
      </div>
     </div>
     <div class="glass-card rounded-xl p-4 shadow-lg border border-emerald-100 animate-fade-in" style="opacity: 0; animation-delay: 0.4s;">
      <div class="text-2xl md:text-3xl font-bold" style="color: #047857;" id="stat-avg-juz">
       0
      </div>
      <div class="text-xs md:text-sm text-gray-600">
       Rata-rata Juz
      </div>
     </div>
    </div>
   </div><!-- Main Content -->
   <main class="max-w-6xl mx-auto px-4 py-8">
    <main class="max-w-6xl mx-auto px-4 py-8">

  <!-- Tombol Cara Pengisian (LETAAKKAN DI SINI) -->
  <div class="mb-6">
    <button 
      onclick="togglePanduan()" 
      class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-4 rounded-xl shadow-md transition duration-300">
      üìñ Cara Pengisian
    </button>

    <div id="panduanPengisian" 
         class="hidden mt-3 bg-emerald-50 border border-emerald-200 rounded-xl p-4 text-sm text-gray-700 transition-all duration-300"> 
         <h3 class="text-lg md:text-xl font-bold text-emerald-700 mb-2">
  üìñ Panduan Pengisian
</h3>
      <ul class="list-disc pl-5 space-y-1">
        <li>Isi <b>Jumlah Juz</b> sesuai juz terakhir yang sedang dibaca.</li>
        <li>Isi <b>Jumlah Halaman</b> sesuai halaman terakhir yang sedang dibaca.</li>
        <li>Contoh: Jika saat ini membaca <b>Juz 5 halaman 81</b>, maka:</li>
        <li class="ml-4">‚Üí Jumlah Juz: <b>5</b></li>
        <li class="ml-4">‚Üí Jumlah Halaman: <b>81</b></li>
        <li>Nomor halaman bersifat <b>berlanjut (1‚Äì604)</b>.</li>
      </ul>
    </div>
  </div>
    <div class="grid lg:grid-cols-3 gap-6"><!-- Form Input -->
     <div class="lg:col-span-1">
      <div class="glass-card rounded-2xl shadow-xl border border-emerald-100 overflow-hidden">
       <div class="p-4 border-b border-emerald-100" style="background-color: #047857;">
        <h2 class="text-lg font-bold text-white flex items-center gap-2">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
         </svg><span id="form-title">Tambah Data Bacaan</span></h2>
       </div>
       <form id="add-form" class="p-5 space-y-4">
        <div><label class="block text-sm font-medium text-gray-700 mb-1">Nama Siswa</label> <input type="text" id="input-nama" required placeholder="Masukkan nama lengkap" class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all">
        </div>
       <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">
        Kelas
    </label>

    <select 
        id="input-kelas" 
        required 
        class="w-full px-4 py-2.5 rounded-lg border border-gray-300 
               focus:ring-2 focus:ring-emerald-500 
               focus:border-emerald-500 transition-all">
        <option value="">Pilih Kelas</option>

        <!-- Kelas X -->
        <option value="X PS 1">X PS 1</option>
        <option value="X PS 2">X PS 2</option>
        <option value="X TKJ 1">X TKJ 1</option>
        <option value="X TKJ 2">X TKJ 2</option>
        <option value="X DKV 1">X DKV 1</option>
        <option value="X DKV 2">X DKV 2</option>
        <option value="X PM 1">X PM 1</option>
        <option value="X PM 2">X PM 2</option>
        <option value="X MPLB 1">X MPLB 1</option>
        <option value="X MPLB 2">X MPLB 2</option>
        <option value="X MPLB 2">X MPLB 3</option>
        <!-- Kelas XI -->
       <option value="XI PS 1">XI PS 1</option>
        <option value="XI PS 2">XI PS 2</option>
        <option value="XI TKJ 1">XI TKJ 1</option>
        <option value="XI TKJ 2">XI TKJ 2</option>
        <option value="XI DKV 1">XI DKV 1</option>
        <option value="XI DKV 2">XI DKV 2</option>
        <option value="XI PM 1">XI PM 1</option>
        <option value="XI PM 2">XI PM 2</option>
        <option value="XI MPLB 1">XI MPLB 1</option>
        <option value="XI MPLB 2">XI MPLB 2</option>
        <option value="XI MPLB 2">XI MPLB 3</option>

        <!-- Kelas XII -->
        <option value="XII PS 1">XII PS 1</option>
        <option value="XII PS 2">XII PS 2</option>
        <option value="XII TKJ 1">XII TKJ 1</option>
        <option value="XII TKJ 2">XII TKJ 2</option>
        <option value="XII DKV 1">XII DKV 1</option>
        <option value="XII DKV 2">XII DKV 2</option>
        <option value="XII PM 1">XII PM 1</option>
        <option value="XII PM 2">XII PM 2</option>
        <option value="XII MPLB 1">XII MPLB 1</option>
        <option value="XII MPLB 2">XII MPLB 2</option>
        <option value="XII MPLB 2">XII MPLB 3</option>
    </select>
</div>

        <div class="grid grid-cols-2 gap-3">
         <div><label class="block text-sm font-medium text-gray-700 mb-1">Jumlah Juz</label> <input type="number" id="input-juz" required min="0" max="30" placeholder="0" class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all">
         </div>
         <div><label class="block text-sm font-medium text-gray-700 mb-1">Jumlah Halaman</label> <input type="number" id="input-halaman" required min="0" placeholder="0" class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all">
         </div>
        </div><button type="submit" id="btn-submit" class="w-full py-3 rounded-lg font-semibold text-white transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2" style="background-color: #047857;">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg><span>Simpan Data</span> </button> <button type="button" id="btn-cancel" class="hidden w-full py-2.5 rounded-lg font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 transition-all"> Batal Edit </button>
       </form>
       <div id="form-message" class="hidden px-5 pb-5">
        <div class="p-3 rounded-lg text-sm"></div>
       </div>
      </div><!-- Filter -->
      <div class="glass-card rounded-2xl shadow-xl border border-emerald-100 mt-4 p-4">
    
    <h3 class="font-semibold text-gray-700 mb-3">
        Filter Kelas
    </h3>

    <select 
        id="filter-kelas"
        class="w-full px-4 py-2.5 rounded-lg border border-gray-300 
               focus:ring-2 focus:ring-emerald-500 
               focus:border-emerald-500"
    >
        <option value="">Semua Kelas</option>

        <!-- Kelas X -->
        <option value="X PS 1">X PS 1</option>
        <option value="X PS 2">X PS 2</option>
        <option value="X TKJ 1">X TKJ 1</option>
        <option value="X TKJ 2">X TKJ 2</option>
        <option value="X DKV 1">X DKV 1</option>
        <option value="X DKV 2">X DKV 2</option>
        <option value="X PM 1">X PM 1</option>
        <option value="X PM 2">X PM 2</option>
        <option value="X MPLB 1">X MPLB 1</option>
        <option value="X MPLB 2">X MPLB 2</option>
        <option value="X MPLB 2">X MPLB 3</option>
        <!-- Kelas XI -->
       <option value="XI PS 1">XI PS 1</option>
        <option value="XI PS 2">XI PS 2</option>
        <option value="XI TKJ 1">XI TKJ 1</option>
        <option value="XI TKJ 2">XI TKJ 2</option>
        <option value="XI DKV 1">XI DKV 1</option>
        <option value="XI DKV 2">XI DKV 2</option>
        <option value="XI PM 1">XI PM 1</option>
        <option value="XI PM 2">XI PM 2</option>
        <option value="XI MPLB 1">XI MPLB 1</option>
        <option value="XI MPLB 2">XI MPLB 2</option>
        <option value="XI MPLB 2">XI MPLB 3</option>

        <!-- Kelas XII -->
        <option value="XII PS 1">XII PS 1</option>
        <option value="XII PS 2">XII PS 2</option>
        <option value="XII TKJ 1">XII TKJ 1</option>
        <option value="XII TKJ 2">XII TKJ 2</option>
        <option value="XII DKV 1">XII DKV 1</option>
        <option value="XII DKV 2">XII DKV 2</option>
        <option value="XII PM 1">XII PM 1</option>
        <option value="XII PM 2">XII PM 2</option>
        <option value="XII MPLB 1">XII MPLB 1</option>
        <option value="XII MPLB 2">XII MPLB 2</option>
        <option value="XII MPLB 2">XII MPLB 3</option>
    </select>

    


</div>

<div class="glass-card rounded-2xl shadow-xl border border-emerald-100 mt-4 p-4">
  <h3 class="font-semibold text-gray-700 mb-3">Filter Angkatan</h3>

  <div class="grid grid-cols-3 gap-2">
    <button onclick="filterByAngkatan('X')" 
      class="py-2 rounded-lg bg-emerald-600 text-white text-sm font-medium">
      Kelas X
    </button>

    <button onclick="filterByAngkatan('XI')" 
      class="py-2 rounded-lg bg-emerald-600 text-white text-sm font-medium">
      Kelas XI
    </button>

    <button onclick="filterByAngkatan('XII')" 
      class="py-2 rounded-lg bg-emerald-600 text-white text-sm font-medium">
      Kelas XII
    </button>
  </div>

  <button onclick="filterByAngkatan('')" 
    class="mt-3 w-full py-2 rounded-lg bg-gray-200 text-gray-700 text-sm">
    Tampilkan Semua
  </button>
</div>

     </div><!-- Ranking Table -->
     <div class="lg:col-span-2">
      <div class="glass-card rounded-2xl shadow-xl border border-emerald-100 overflow-hidden">
       <div class="p-4 border-b border-emerald-100 flex items-center justify-between" style="background-color: #047857;">
        <h2 class="text-lg font-bold text-white flex items-center gap-2">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
         </svg> Peringkat Pembaca Al-Quran</h2><span id="data-count" class="text-emerald-100 text-sm">0 data</span>
       </div><!-- Top 3 Podium -->
       <div id="podium-section" class="hidden p-6 border-b border-emerald-100 bg-gradient-to-b from-emerald-50 to-white">
        <div class="flex items-end justify-center gap-2 md:gap-4"><!-- 2nd Place -->
         <div id="podium-2" class="text-center">
          <div class="w-16 h-16 md:w-20 md:h-20 mx-auto mb-2 rounded-full rank-silver flex items-center justify-center text-white font-bold text-xl md:text-2xl shadow-lg">
           2
          </div>
          <div class="text-sm md:text-base font-semibold text-gray-800 truncate max-w-[80px] md:max-w-[120px]" id="podium-2-name">
           -
          </div>
          <div class="text-xs text-gray-500" id="podium-2-juz">
           0 Juz
          </div>
          <div class="w-16 md:w-24 h-16 md:h-20 rank-silver mt-2 rounded-t-lg"></div>
         </div><!-- 1st Place -->
         <div id="podium-1" class="text-center -mt-4">
          <div class="text-2xl md:text-3xl mb-1">
           üëë
          </div>
          <div class="w-20 h-20 md:w-24 md:h-24 mx-auto mb-2 rounded-full rank-gold flex items-center justify-center text-white font-bold text-2xl md:text-3xl shadow-lg">
           1
          </div>
          <div class="text-sm md:text-base font-bold text-gray-800 truncate max-w-[100px] md:max-w-[140px]" id="podium-1-name">
           -
          </div>
          <div class="text-xs text-gray-500" id="podium-1-juz">
           0 Juz
          </div>
          <div class="w-20 md:w-28 h-20 md:h-24 rank-gold mt-2 rounded-t-lg"></div>
         </div><!-- 3rd Place -->
         <div id="podium-3" class="text-center">
          <div class="w-14 h-14 md:w-18 md:h-18 mx-auto mb-2 rounded-full rank-bronze flex items-center justify-center text-white font-bold text-lg md:text-xl shadow-lg">
           3
          </div>
          <div class="text-sm md:text-base font-semibold text-gray-800 truncate max-w-[70px] md:max-w-[100px]" id="podium-3-name">
           -
          </div>
          <div class="text-xs text-gray-500" id="podium-3-juz">
           0 Juz
          </div>
          <div class="w-14 md:w-20 h-12 md:h-16 rank-bronze mt-2 rounded-t-lg"></div>
         </div>
        </div>
       </div><!-- Table -->
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead style="background-color: #ecfdf5;">
          <tr>
           <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Rank</th>
           <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Nama</th>
           <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Kelas</th>
           <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Juz</th>
           <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Halaman</th>
          </tr>
         </thead>
         <tbody id="ranking-table" class="divide-y divide-gray-100"><!-- Data will be inserted here -->
         </tbody>
        </table>
       </div><!-- Empty State -->
       <div id="empty-state" class="hidden p-12 text-center">
        <div class="text-6xl mb-4">
         üìñ
        </div>
        <h3 class="text-lg font-semibold text-gray-700 mb-2">Belum Ada Data</h3>
        <p class="text-gray-500">Mulai tambahkan data bacaan Al-Quran siswa</p>
       </div><!-- Loading State -->
       <div id="loading-state" class="p-12 text-center">
        <div class="animate-spin w-12 h-12 border-4 border-emerald-200 border-t-emerald-600 rounded-full mx-auto mb-4"></div>
        <p class="text-gray-500">Memuat data...</p>
       </div><!-- Limit Warning -->
       <div id="limit-warning" class="hidden p-4 bg-amber-50 border-t border-amber-200">
        <p class="text-amber-700 text-sm text-center">‚ö†Ô∏è Batas maksimum 999 data telah tercapai. Hapus beberapa data untuk menambah yang baru.</p>
       </div>
      </div>
     </div>
    </div>
   </main><!-- Footer -->
   <footer class="text-center py-6 text-gray-500 text-sm border-t border-emerald-100" style="background-color: #ecfdf5;">
    <p>¬© 2026 SMKN 5 Samarinda - Program Literasi Al-Quran</p>
   </footer><!-- Delete Confirmation Modal -->
   <div id="delete-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4" style="background-color: rgba(0,0,0,0.5);">
    <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6">
     <div class="text-center">
      <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-red-100 flex items-center justify-center">
       <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
       </svg>
      </div>
      <h3 class="text-lg font-bold text-gray-800 mb-2">Hapus Data?</h3>
      <p class="text-gray-600 mb-6" id="delete-confirm-text">Apakah Anda yakin ingin menghapus data ini?</p>
      <div class="flex gap-3"><button id="btn-cancel-delete" class="flex-1 py-2.5 rounded-lg font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 transition-all"> Batal </button> <button id="btn-confirm-delete" class="flex-1 py-2.5 rounded-lg font-medium text-white bg-red-600 hover:bg-red-700 transition-all"> Hapus </button>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    // Google Apps Script URL
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw4A8WUeIsEKG2ifGclccg6om8k4KGX4a1CopM_KQWB1PNib8IQy8A0FlgaJfxi0eaj/exec';

    // Default configuration
    const defaultConfig = {
      app_title: 'Ranking Pembaca Al-Quran',
      school_name: 'SMKN 5 Samarinda',
      subtitle: 'Program Literasi Al-Quran',
      primary_color: '#047857',
      secondary_color: '#f0fdf4',
      text_color: '#1f2937',
      font_family: 'Plus Jakarta Sans',
      font_size: 16
    };

    // Application state
    let allData = [];
    let filteredData = [];
    let editingRecord = null;
    let deleteRecord = null;
    let currentRecordCount = 0;
    let isLoading = false;
    let currentPage = 1;
    const itemsPerPage = 5;

    // DOM Elements
    const form = document.getElementById('add-form');
    const inputNama = document.getElementById('input-nama');
    const inputKelas = document.getElementById('input-kelas');
    const inputJuz = document.getElementById('input-juz');
    const inputHalaman = document.getElementById('input-halaman');
    const btnSubmit = document.getElementById('btn-submit');
    const btnCancel = document.getElementById('btn-cancel');
    const filterKelas = document.getElementById('filter-kelas');
    const rankingTable = document.getElementById('ranking-table');
    const emptyState = document.getElementById('empty-state');
    const loadingState = document.getElementById('loading-state');
    const podiumSection = document.getElementById('podium-section');
    const limitWarning = document.getElementById('limit-warning');
    const deleteModal = document.getElementById('delete-modal');
    const formMessage = document.getElementById('form-message');

    // Show message
    function showMessage(message, isError = false) {
      const messageDiv = formMessage.querySelector('div');
      messageDiv.textContent = message;
      messageDiv.className = `p-3 rounded-lg text-sm ${isError ? 'bg-red-100 text-red-700' : 'bg-emerald-100 text-emerald-700'}`;
      formMessage.classList.remove('hidden');
      setTimeout(() => formMessage.classList.add('hidden'), 3000);
    }

    // Fetch data from Google Sheets
    async function loadDataFromSheets() {
      try {
        isLoading = true;
        const response = await fetch(APPS_SCRIPT_URL);
        const data = await response.json();
        
        if (Array.isArray(data)) {
          allData = data.map((item, index) => ({
            __backendId: index.toString(),
            nama: item.nama || '',
            kelas: item.kelas || '',
            jumlah_juz: parseInt(item.jumlah_juz) || 0,
            jumlah_halaman: parseInt(item.jumlah_halaman) || 0,
            tanggal_update: item.tanggal_update || new Date().toISOString()
          }));
          
          applyFilter();
          loadingState.classList.add('hidden');
        }
      } catch (error) {
        console.error('Error loading data:', error);
        loadingState.innerHTML = `
          <div class="text-red-500 mb-4">‚ö†Ô∏è</div>
          <p class="text-red-600">Gagal memuat data. Periksa koneksi internet Anda.</p>
        `;
      } finally {
        isLoading = false;
      }
    }

    // Update statistics
    function updateStats() {
      const totalSiswa = allData.length;
      const totalJuz = allData.reduce((sum, d) => sum + (d.jumlah_juz || 0), 0);
      const totalHalaman = allData.reduce((sum, d) => sum + (d.jumlah_halaman || 0), 0);
      const avgJuz = totalSiswa > 0 ? (totalJuz / totalSiswa).toFixed(1) : 0;

      document.getElementById('stat-total-siswa').textContent = totalSiswa;
      document.getElementById('stat-total-juz').textContent = totalJuz;
      document.getElementById('stat-total-halaman').textContent = totalHalaman;
      document.getElementById('stat-avg-juz').textContent = avgJuz;
      document.getElementById('data-count').textContent = `${filteredData.length} data`;

      currentRecordCount = totalSiswa;
      limitWarning.classList.toggle('hidden', currentRecordCount < 999);
    }

    // Update podium
    function updatePodium() {
      const sorted = [...filteredData].sort((a, b) => {
        if (b.jumlah_juz !== a.jumlah_juz) return b.jumlah_juz - a.jumlah_juz;
        return b.jumlah_halaman - a.jumlah_halaman;
      });

      if (sorted.length >= 3) {
        podiumSection.classList.remove('hidden');
        
        document.getElementById('podium-1-name').textContent = sorted[0].nama;
        document.getElementById('podium-1-juz').textContent = `${sorted[0].jumlah_juz} Juz`;
        
        document.getElementById('podium-2-name').textContent = sorted[1].nama;
        document.getElementById('podium-2-juz').textContent = `${sorted[1].jumlah_juz} Juz`;
        
        document.getElementById('podium-3-name').textContent = sorted[2].nama;
        document.getElementById('podium-3-juz').textContent = `${sorted[2].jumlah_juz} Juz`;
      } else {
        podiumSection.classList.add('hidden');
      }
    }

    // Render table
    function renderTable() {
  const sorted = [...filteredData].sort((a, b) => {
    if (b.jumlah_juz !== a.jumlah_juz) return b.jumlah_juz - a.jumlah_juz;
    return b.jumlah_halaman - a.jumlah_halaman;
  });

  if (sorted.length === 0) {
    rankingTable.innerHTML = '';
    emptyState.classList.remove('hidden');
    document.getElementById('pagination').innerHTML = '';
    return;
  }

  emptyState.classList.add('hidden');

  // Pagination logic
  const totalPages = Math.ceil(sorted.length / itemsPerPage);
  if (currentPage > totalPages) currentPage = 1;

  const startIndex = (currentPage - 1) * itemsPerPage;
  const endIndex = startIndex + itemsPerPage;
  const paginatedData = sorted.slice(startIndex, endIndex);

  rankingTable.innerHTML = '';

  paginatedData.forEach((item, index) => {
    const globalRank = startIndex + index + 1;
    const row = createRow(item, globalRank);
    rankingTable.appendChild(row);
  });

  renderPagination(totalPages);
}

function renderPagination(totalPages) {
  let paginationContainer = document.getElementById('pagination');

  if (!paginationContainer) {
    paginationContainer = document.createElement('div');
    paginationContainer.id = 'pagination';
    paginationContainer.className = 'p-4 flex justify-center gap-2 border-t';
    rankingTable.parentElement.parentElement.appendChild(paginationContainer);
  }

  paginationContainer.innerHTML = '';

  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement('button');
    btn.textContent = i;
    btn.className = `px-3 py-1 rounded-md text-sm ${
      i === currentPage
        ? 'bg-emerald-600 text-white'
        : 'bg-gray-200 text-gray-700'
    }`;

    btn.onclick = () => {
      currentPage = i;
      renderTable();
    };

    paginationContainer.appendChild(btn);
  }
}


    // Create table row
    function createRow(item, rank) {
      const row = document.createElement('tr');
      row.dataset.id = item.__backendId;
      row.className = 'hover:bg-emerald-50 transition-colors';
      updateRowContent(row, item, rank);
      return row;
    }

    // Update row content
    function updateRowContent(row, item, rank) {
      let rankBadge = '';
      if (rank === 1) rankBadge = '<span class="inline-flex items-center justify-center w-8 h-8 rounded-full rank-gold text-white font-bold text-sm">1</span>';
      else if (rank === 2) rankBadge = '<span class="inline-flex items-center justify-center w-8 h-8 rounded-full rank-silver text-white font-bold text-sm">2</span>';
      else if (rank === 3) rankBadge = '<span class="inline-flex items-center justify-center w-8 h-8 rounded-full rank-bronze text-white font-bold text-sm">3</span>';
      else rankBadge = `<span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-gray-200 text-gray-700 font-semibold text-sm">${rank}</span>`;

      row.innerHTML = `
        <td class="px-4 py-3">${rankBadge}</td>
        <td class="px-4 py-3">
          <div class="font-medium text-gray-800">${escapeHtml(item.nama)}</div>
          <div class="text-xs text-gray-500">${formatDate(item.tanggal_update)}</div>
        </td>
        <td class="px-4 py-3">
          <span class="inline-flex px-2.5 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700">${escapeHtml(item.kelas)}</span>
        </td>
        <td class="px-4 py-3 text-center">
          <span class="font-bold text-lg" style="color: #047857;">${item.jumlah_juz}</span>
        </td>
        <td class="px-4 py-3 text-center">
          <span class="font-medium text-gray-700">${item.jumlah_halaman}</span>
        </td>
      `;
    }

    // Update existing row
    function updateRow(row, item, rank) {
      updateRowContent(row, item, rank);
    }

    // Helper functions
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function formatDate(isoString) {
      if (!isoString) return '-';
      const date = new Date(isoString);
      return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
    }

    // Filter data
    function filterByAngkatan(angkatan) {
  if (!angkatan) {
    filteredData = [...allData];
  } else {
    filteredData = allData.filter(d => 
      d.kelas.startsWith(angkatan)
    );
  }
    currentPage = 1;

  updateStats();
  updatePodium();
  renderTable();
}


 function applyFilter() {
  const filterValue = filterKelas.value;

  if (filterValue) {
    filteredData = allData.filter(d => d.kelas === filterValue);
  } else {
    filteredData = [...allData];
  }

  currentPage = 1; // reset ke halaman pertama
  updateStats();
  updatePodium();
  renderTable();
}


    // Edit record
    window.editRecord = function(id) {
      const record = allData.find(d => d.__backendId === id);
      if (!record) return;

      editingRecord = record;
      inputNama.value = record.nama;
      inputKelas.value = record.kelas;
      inputJuz.value = record.jumlah_juz;
      inputHalaman.value = record.jumlah_halaman;

      document.getElementById('form-title').textContent = 'Edit Data Bacaan';
      btnSubmit.querySelector('span').textContent = 'Update Data';
      btnCancel.classList.remove('hidden');

      inputNama.focus();
    };

    // Cancel edit
    btnCancel.addEventListener('click', () => {
      resetForm();
    });

    function resetForm() {
      editingRecord = null;
      form.reset();
      document.getElementById('form-title').textContent = 'Tambah Data Bacaan';
      btnSubmit.querySelector('span').textContent = 'Simpan Data';
      btnCancel.classList.add('hidden');
    }

    // Delete confirmation
    window.confirmDelete = function(id) {
      const record = allData.find(d => d.__backendId === id);
      if (!record) return;

      deleteRecord = record;
      document.getElementById('delete-confirm-text').textContent = `Hapus data "${record.nama}" dari ${record.kelas}?`;
      deleteModal.classList.remove('hidden');
    };

    document.getElementById('btn-cancel-delete').addEventListener('click', () => {
      deleteRecord = null;
      deleteModal.classList.add('hidden');
    });

    document.getElementById('btn-confirm-delete').addEventListener('click', async () => {
      if (!deleteRecord) return;

      const btn = document.getElementById('btn-confirm-delete');
      btn.disabled = true;
      btn.textContent = 'Menghapus...';

      try {
        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'delete',
            rowIndex: parseInt(deleteRecord.__backendId)
          })
        });

        const result = await response.json();
        
        if (result.success) {
          showMessage('Data berhasil dihapus');
          loadDataFromSheets();
        } else {
          showMessage('Gagal menghapus data', true);
        }
      } catch (error) {
        console.error('Error:', error);
        showMessage('Gagal menghapus data: ' + error.message, true);
      }

      btn.disabled = false;
      btn.textContent = 'Hapus';
      deleteRecord = null;
      deleteModal.classList.add('hidden');
    });

    // Form submit
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const nama = inputNama.value.trim();
      const kelas = inputKelas.value;
      const jumlah_juz = parseInt(inputJuz.value) || 0;
      const jumlah_halaman = parseInt(inputHalaman.value) || 0;

      if (!nama || !kelas) {
        showMessage('Mohon lengkapi semua field', true);
        return;
      }

      btnSubmit.disabled = true;
      btnSubmit.querySelector('span').textContent = editingRecord ? 'Menyimpan...' : 'Menyimpan...';

      try {
        if (editingRecord) {
          // Update existing record
          const response = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({
              action: 'update',
              rowIndex: parseInt(editingRecord.__backendId),
              nama,
              kelas,
              jumlah_juz,
              jumlah_halaman
            })
          });

          const result = await response.json();
          
          if (result.success) {
            showMessage('Data berhasil diupdate');
            resetForm();
            loadDataFromSheets();
          } else {
            showMessage('Gagal mengupdate data', true);
          }
        } else {
          // Create new record
          if (currentRecordCount >= 999) {
            showMessage('Batas maksimum 999 data telah tercapai', true);
            btnSubmit.disabled = false;
            btnSubmit.querySelector('span').textContent = 'Simpan Data';
            return;
          }

          const response = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({
              action: 'add',
              nama,
              kelas,
              jumlah_juz,
              jumlah_halaman
            })
          });

          const result = await response.json();
          
          if (result.success) {
            showMessage('Data berhasil disimpan');
            form.reset();
            loadDataFromSheets();
          } else {
            showMessage('Gagal menyimpan data', true);
          }
        }
      } catch (error) {
        console.error('Error:', error);
        showMessage('Gagal menyimpan data: ' + error.message, true);
      }

      btnSubmit.disabled = false;
      btnSubmit.querySelector('span').textContent = editingRecord ? 'Update Data' : 'Simpan Data';
    });

    // Filter change
    filterKelas.addEventListener('change', applyFilter);

    // Element SDK configuration
    async function onConfigChange(config) {
      const title = config.app_title || defaultConfig.app_title;
      const schoolName = config.school_name || defaultConfig.school_name;
      const subtitle = config.subtitle || defaultConfig.subtitle;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const textColor = config.text_color || defaultConfig.text_color;

      document.getElementById('app-title').textContent = title;
      document.getElementById('school-name').textContent = schoolName;
      document.getElementById('subtitle').textContent = subtitle;

      // Apply font
      const fontStack = `${fontFamily}, Plus Jakarta Sans, sans-serif`;
      document.body.style.fontFamily = fontStack;

      // Apply font sizes
      document.getElementById('app-title').style.fontSize = `${fontSize * 2}px`;
      document.getElementById('school-name').style.fontSize = `${fontSize * 1.25}px`;
      document.getElementById('subtitle').style.fontSize = `${fontSize * 0.9}px`;

      // Apply colors
      document.getElementById('app-container').style.backgroundColor = secondaryColor;
      document.querySelectorAll('[style*="background-color: #047857"]').forEach(el => {
        el.style.backgroundColor = primaryColor;
      });
      document.querySelectorAll('[style*="color: #047857"]').forEach(el => {
        el.style.color = primaryColor;
      });
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.secondary_color || defaultConfig.secondary_color,
            set: (value) => { config.secondary_color = value; window.elementSdk.setConfig({ secondary_color: value }); }
          },
          {
            get: () => config.primary_color || defaultConfig.primary_color,
            set: (value) => { config.primary_color = value; window.elementSdk.setConfig({ primary_color: value }); }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => { config.text_color = value; window.elementSdk.setConfig({ text_color: value }); }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || defaultConfig.font_family,
          set: (value) => { config.font_family = value; window.elementSdk.setConfig({ font_family: value }); }
        },
        fontSizeable: {
          get: () => config.font_size || defaultConfig.font_size,
          set: (value) => { config.font_size = value; window.elementSdk.setConfig({ font_size: value }); }
        }
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['app_title', config.app_title || defaultConfig.app_title],
        ['school_name', config.school_name || defaultConfig.school_name],
        ['subtitle', config.subtitle || defaultConfig.subtitle]
      ]);
    }

    // Initialize
    async function init() {
      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }

      // Load data from Google Sheets
      await loadDataFromSheets();
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d2c7efaf4e7457a',t:'MTc3MTkxMDI0MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
 <script>
function togglePanduan() {
  const panduan = document.getElementById("panduanPengisian");
  panduan.classList.toggle("hidden");
}
</script>

</body>
</html>